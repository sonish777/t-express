(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{qpZ7:function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return b})),n.d(t,"default",(function(){return p}));var i=n("IKa1"),a=n("Yh9w"),s=(n("r0ML"),n("V0Ug")),r=n("sN0p");n("xH0s");const o=["components"],b={};void 0!==b&&b&&b===Object(b)&&Object.isExtensible(b)&&!Object.prototype.hasOwnProperty.call(b,"__filemeta")&&Object.defineProperty(b,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"src/docs/queue-publisher.mdx"}});const u={_frontmatter:b},l=r.a;function p(e){let{components:t}=e,n=Object(a.a)(e,o);return Object(s.b)(l,Object(i.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(s.b)("h1",{id:"queue---publisher"},"Queue - Publisher"),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"Publisher")," is responsible for registering queues, and publishing messages to those queues. For this, create an instance of the ",Object(s.b)("inlineCode",{parentName:"p"},"Publisher")," class imported from the ",Object(s.b)("inlineCode",{parentName:"p"},"rabbitmq")," package and use the following methods."),Object(s.b)("h2",{id:"registering-queues"},"Registering Queues"),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"registerQueues()")," method is responsible for registering queues with the exchange on the RabbitMQ server. The method takes 3 arguments, the name of the exchange to register the queue to, the routing keys for binding the queue to, and an optional options object that takes durableExchange and durableQueue properties. This method will create a queue for each routing key specified and bind it to the exchange."),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript"},"\nimport { Publisher } from 'rabbitmq';\n\nclass SomeController {\n    constructor(\n        // Inject an instance of Publisher\n        private readonly publisher: Publisher\n    ) {\n        this.publisher.registerQueues('CMS_EXCHANGE', [\n            'activity_log',\n            'generate_thumbnail',\n        ]);\n    }\n}\n\n")),Object(s.b)("p",null,"Above example registers two queues in the exchange ",Object(s.b)("inlineCode",{parentName:"p"},"CMS_EXCHANGE")," and binds them to the routing keys ",Object(s.b)("inlineCode",{parentName:"p"},"activity_log")," and ",Object(s.b)("inlineCode",{parentName:"p"},"generate_thumbnail"),"."),Object(s.b)("p",null,"Sometimes, it is often desirable to register to queues on system startup. To do this, wrap your application bootstrap function with the ",Object(s.b)("inlineCode",{parentName:"p"},"InjectPublisher")," higher order function to get the publisher instance as the first argument."),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript"},"\nimport { InjectPublisher, Publisher } from 'rabbitmq';\n// Get the publisher instance as the first argument\nfunction bootstrap(publisher: Publisher) {\n    const server = new Server(controllers);\n    publisher.registerQueues('CMS_EXCHANGE', [\n        'activity_log',\n        'generate_thumbnail',\n    ]);\n}\n\nInjectPublisher(bootstrap)();\n\n")),Object(s.b)("h2",{id:"publishing-messages-to-queue"},"Publishing Messages to Queue"),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"publish()")," method is responsible for sending a message to the queue. This method will take the exchange name, routing key, and message as parameters and publish the message to the appropriate queue. This method takes 3 arguments: the exchange name, the routing key to pass the message to, and the message itself."),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript"},"\ninterface IActivityLogPayload {\n    activityTimestamp: Date;\n    description: string;\n}\n\nclass MyService {\n    constructor(\n        // Inject the publisher instance\n        private readonly publisher: Publisher\n    ) {}\n\n    doSomethingAndPublishMessage() {\n        // do something...\n        this.publisher.publish<IActivityLogPayload>('CMS_EXCHANGE', 'activity_log', {\n            activityTimestamp: new Date(),\n            description: `Someone did \"something\"`,\n        });\n    }\n}\n\n")),Object(s.b)("p",null,"Above example publishes a message to ",Object(s.b)("inlineCode",{parentName:"p"},"'activity_queue'")," routing key in the ",Object(s.b)("inlineCode",{parentName:"p"},"'CMS_EXCHANGE'")," exchange. The optional ",Object(s.b)("inlineCode",{parentName:"p"},"type")," argument ",Object(s.b)("inlineCode",{parentName:"p"},"IActivityLogPayload")," can be passed to add type safety to the message payload."))}void 0!==p&&p&&p===Object(p)&&Object.isExtensible(p)&&!Object.prototype.hasOwnProperty.call(p,"__filemeta")&&Object.defineProperty(p,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"src/docs/queue-publisher.mdx"}}),p.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-docs-queue-publisher-mdx-90f9155a7c2cd67f8b73.js.map
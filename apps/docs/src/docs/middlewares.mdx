---
name: Middlewares
menu: Docs
route: /middlewares
---

# Middlewares and Providers

Middlewares are basically Express middlewares. Middleware Providers on the other hand are also middlewares but they require extra configuration and have extra logic attached to them. They help to segregate such logic to the concerned middleware being applied.

## Creating a middleware provider

Middleware providers are created as classes implementing the ProviderStaticMethod interface that enforces a static `register` method that takes `Express.App` as the first argument and an optional second argument that can be used to configure the middleware as needed.


### Example

```javascript

class CORSProvider implements ProviderStaticMethod<typeof CORSProvider> {
    public static register(app: Express, whitelist: string[] = []) {
        if (process.env.NODE_ENV === 'development') {
            app.use(cors());
        } else {
            whitelist = [cmsUrl, apiUrl, ...whitelist];
            app.use(
                cors({
                    origin: function (requestOrigin, callback) {
                        // Whitelist the request origin
                    },
                })
            );
        }
    }
}

```

In above above example, `CORSProvider` is a middleware provider for applying the `cors` middleware. The first argument is the Express.Application. The second argument is an array of string URLs that needs to be whitelisted for allowing CORS.
> Passing `<typeof CORSProvider>` is needed to enforce overriding of the static `register` method.

## Applying Middleware Providers

Middleware providers are registered during the server startup process. There are 2 different ways of applying the middleware provider.

1. Middleware Providers that **do not** require the second configuration argument

```javascript

server.startup({
    middlewareProviders: [
        PassportProvider
    ]
});

```
> The `register` method in `PassportProvider` doesn't require the second configuration argument. 

2. Middleware Providers that **require** the second configuration argument. For this, use the `provideMiddleware` function from the core package.

```javascript

server.startup({
    middlewareProviders: [
        provideMiddleware<string[]>(CORSProvider, ['url_to_whitelist']),
    ]
});

```

> `<string[]>` is used to add type support for passing argument to the provider.
---
name: Mail
menu: Extras
route: /mail
---

# Mail

Texpress provides a `Mailer` utility shared class that simplifies sending email messages using the `nodemailer` library.
You'll need to create email templates before sending emails.  
Email templates are stored in the database and identified by a unique `code`. When sending an email, the Mailer instance retrieves the email template from the database , and then parses the email template using the parseTemplate method with the dynamic data.

## Mailer Credential Prerequisites

Since the `Mailer` utility uses STMP, you'll need to create STMP credentials to be used for sending email. These credentials are set in the configuration json files under the following names,

```javascript
{
    // other configs,
    "mail": {
        "host": // host of the mail server,
        "port": // port of the mail server,
        "username": // smtp username
        "password": // smtp password
        "secure": // stmp secure (true/false)
        "from": // default from email address
    }
}
```

## Creating Mailers and Sending Mails

To send emails using the `Mailer` utility, create your mailer class extending the `Mailer` and create a method say `send()` to send the email. To send the email, call the `parseTemplate()` method to get the email template from the database (uses `email_templates` table in the database) with matching `code`, and pass the data as the second argument that needs to be replaced in placeholders in that email template. Also, set the `'to'` property to receiver's email address and finally call the `sendEmail()` to send the email.

```javascript

class SendOTPMailer extends Mailer {
    private readonly code = 'SEND_OTP';
    async send(data: Record<string, string>) {
        (await this.parseTemplate(this.code, data))
            .to(data.to_email)
            .sendEmail();
    }
}

```

Above example creates a OTP mailer that sends an email with template matching the code `'SEND_OTP'` in the database.  
Now, to send the email.

```javascript

class AuthService {
    constructor(
        // Inject the mailer instance
        // Make sure to decorate your mailer by typedi's @Service decorator to make them injectable
        private readonly sendOtpMailer: SendOTPMailer
    ) {}

    doSomethingAndSendEmail() {
        // do `something`
        this.sendOtpMailer.send({
            to_email: 'receiver@email.goes.here',
            // other data needed in the email template.
        });
    }
}

```

## Mail Preview

During development, it may be useful to only preview the email instead of actually sending it. For this purpose, the `sendEmail` method has a `previewOnly` option that is true by default when the `NODE_ENV` environment variable is not set to `production`. The local email preview shows how the email will look when it is sent, and can be useful for testing and debugging email templates.

However, if you wish to send the email even in a non-production environment, you can pass the `previewOnly` option as false to force the sendEmail method to send the email using the configured transporter.

The mail preview may look something like this:

<img src={require('../images/mail-preview.png')} style="width: 70%;" />

(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"2Cwz":function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return c})),n.d(t,"default",(function(){return d}));var o=n("IKa1"),r=n("Yh9w"),a=(n("r0ML"),n("V0Ug")),s=n("sN0p");n("xH0s");const i=["components"],c={};void 0!==c&&c&&c===Object(c)&&Object.isExtensible(c)&&!Object.prototype.hasOwnProperty.call(c,"__filemeta")&&Object.defineProperty(c,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"src/docs/auth-and-authorize.mdx"}});const p={_frontmatter:c},l=s.a;function d(e){let{components:t}=e,n=Object(r.a)(e,i);return Object(a.b)(l,Object(o.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h1",{id:"authentication-and-authorization"},"Authentication and Authorization"),Object(a.b)("p",null,"Texpress comes with built-in authentication and authorization features. For authentication, you may use the ",Object(a.b)("inlineCode",{parentName:"p"},"ProtectedRoute")," for CMS or the ",Object(a.b)("inlineCode",{parentName:"p"},"APIProtectedRoute")," decorator for APIs for creating protected routes."),Object(a.b)("h2",{id:"protected-routes"},"Protected Routes"),Object(a.b)("p",null,"The CMS's ",Object(a.b)("inlineCode",{parentName:"p"},"ProtectedRoute")," decorator uses the Passport's ",Object(a.b)("inlineCode",{parentName:"p"},"Local Strategy")," by storing sessions on redis to authenticate the users. You may swap this part with your own authentication logic as required. To swap this, you can change the logic of the ",Object(a.b)("inlineCode",{parentName:"p"},"auth")," shared middleware being used by the ",Object(a.b)("inlineCode",{parentName:"p"},"ProtectedRoute")," decorator."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"\nimport { Controller, ProtectedRoute } from 'core/controllers';\n\n@Controller('/my-resource')\nexport class MyResourceController {\n    @ProtectedRoute({ // Registers a protected route in CMS\n        path: '/',\n        method: HTTPMethods.Get,\n    })\n    @CatchAsync\n    async getMyProtectedResouces(req: Request, res: Response) {\n        // handle GET\n    }\n}\n\n")),Object(a.b)("p",null,"Above example registers a protected route ",Object(a.b)("inlineCode",{parentName:"p"},"GET /my-resource")," which throws an ",Object(a.b)("inlineCode",{parentName:"p"},"Unauthorized Exception")," if the user is not logged in.",Object(a.b)("br",{parentName:"p"}),"\n","Similar to this, the ",Object(a.b)("inlineCode",{parentName:"p"},"APIProtectedRoute")," uses Passport's ",Object(a.b)("inlineCode",{parentName:"p"},"JWT Strategy")," to authenticate the user. Again, if you need, you may swap this part with your own authentication logic as required. To swap this, you can change the logic of the ",Object(a.b)("inlineCode",{parentName:"p"},"jwtAuth")," shared middleware being used by the ",Object(a.b)("inlineCode",{parentName:"p"},"APIProtectedRoute")," decorator."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"\nimport { ApiController, APIProtectedRoute } from 'core/controllers';\n\n@ApiController('/my-resource')\nexport class ApiResourceController {\n    @APIProtectedRoute({ // Registers a protected route for API\n        path: '/' ,\n        method: HTTPMethods.Get\n    })\n    async getMyProtectedResouces(req: Request, res: Response) {\n        // handle GET\n    }\n}\n\n")),Object(a.b)("h2",{id:"authorization"},"Authorization"),Object(a.b)("p",null,"The authorization features helps you manage permissions in the ",Object(a.b)("inlineCode",{parentName:"p"},"CMS")," application. The authorization features uses the ",Object(a.b)("inlineCode",{parentName:"p"},"users"),", ",Object(a.b)("inlineCode",{parentName:"p"},"roles"),", ",Object(a.b)("inlineCode",{parentName:"p"},"permissions")," entities to handle the permissions. Authorization can be done in two ways, action based or route based.  "),Object(a.b)("h3",{id:"users-roles-and-permissions"},"Users, Roles, and Permissions"),Object(a.b)("p",null,"Permissions in the CMS are synced to the database from the ",Object(a.b)("inlineCode",{parentName:"p"},"cms.config.ts")," file in the ",Object(a.b)("inlineCode",{parentName:"p"},"texpress-cms/src/configs")," application directory. The permissions from this file are synced to the database when you first run the seeders when setting up ",Object(a.b)("inlineCode",{parentName:"p"},"texpress"),". Along with the permissions, a user with the role of ",Object(a.b)("inlineCode",{parentName:"p"},"'super-admin'")," is also created. The ",Object(a.b)("inlineCode",{parentName:"p"},"'super-admin'")," role always has all the permissions allowed by default. Next time you add new modules, and their permissions to the CMS config file, you can resync these permissions with the database by clicking on the ",Object(a.b)("inlineCode",{parentName:"p"},"Sync Permissions")," button in the CMS application's Permissions page."),Object(a.b)("h3",{id:"action-based-authorization"},"Action Based Authorization"),Object(a.b)("p",null,"The action based authorization simply works by checking if the specified action is in the allowed permissions list of the currently authenticated user. These actions are checked against the ",Object(a.b)("inlineCode",{parentName:"p"},"action")," values stored in the ",Object(a.b)("inlineCode",{parentName:"p"},"permissions")," table. To use this, add the ",Object(a.b)("inlineCode",{parentName:"p"},"canAccess")," middleware whilst registering routes."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"\nimport { canAccess } from 'shared/middlewares';\n\n@Controller('/my-resource')\nexport class ApiResourceController {\n    @ProtectedRoute({ \n        path: '/' ,\n        method: HTTPMethods.Get,\n        middlewares: [canAccess('my-resource.view')] // check if 'my-resource.view' permission is allowed the user\n    })\n    async getMyProtectedResouces(req: Request, res: Response) {\n        // handle GET\n    }\n}\n\n")),Object(a.b)("p",null,"Above example checks if the logged in user is allowed to perform the action ",Object(a.b)("inlineCode",{parentName:"p"},"'my-resource.view'"),". If not, a ",Object(a.b)("inlineCode",{parentName:"p"},"Forbidden Exception")," will be thrown."),Object(a.b)("h3",{id:"route-based-authorization"},"Route Based Authorization"),Object(a.b)("p",null,"The route based authorization checks if the users permission list is allowed to access both the ",Object(a.b)("inlineCode",{parentName:"p"},"route")," as well as the ",Object(a.b)("inlineCode",{parentName:"p"},"HTTP method"),". To add route based authorization, add the ",Object(a.b)("inlineCode",{parentName:"p"},"@CanAccess")," decorator to the controller class.",Object(a.b)("br",{parentName:"p"}),"\n",Object(a.b)("strong",{parentName:"p"},"Note: For now, using ",Object(a.b)("inlineCode",{parentName:"strong"},"@CanAccess")," decorator will authorize all the routes registered in the controller.")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"\nimport { Controller, ProtectedRoute, CanAccess } from 'core/controllers';\n\n@Controller('/my-resource')\n@CanAccess\nexport class ApiResourceController {\n    @ProtectedRoute({\n        path: '/' ,\n        method: HTTPMethods.Get,\n    })\n    async getMyProtectedResouces(req: Request, res: Response) {\n        // handle GET\n    }\n\n    @ProtectedRoute({ \n        path: '/' ,\n        method: HTTPMethods.Post,\n    })\n    async createMyProtectedResouces(req: Request, res: Response) {\n        // handle POST\n    }\n}\n\n")),Object(a.b)("p",null,"In above example, since the ",Object(a.b)("inlineCode",{parentName:"p"},"@CanAccess")," decorator has been used, accessing any of the routes ",Object(a.b)("inlineCode",{parentName:"p"},"GET /my-resource")," or ",Object(a.b)("inlineCode",{parentName:"p"},"POST /my-resource"),", the permissions will be checked against the permissions list of the logged in user. For example, when a logged in user tries to access ",Object(a.b)("inlineCode",{parentName:"p"},"GET /my-resource"),", a check will be made if the user has permission to perform ",Object(a.b)("inlineCode",{parentName:"p"},"GET")," method on the route ",Object(a.b)("inlineCode",{parentName:"p"},"/my-resource"),". If not, a ",Object(a.b)("inlineCode",{parentName:"p"},"Forbidden Exception")," will be thrown. "))}void 0!==d&&d&&d===Object(d)&&Object.isExtensible(d)&&!Object.prototype.hasOwnProperty.call(d,"__filemeta")&&Object.defineProperty(d,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"src/docs/auth-and-authorize.mdx"}}),d.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-docs-auth-and-authorize-mdx-f12e43c1a5172552f38c.js.map
(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"8LwC":function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return c})),n.d(t,"default",(function(){return p}));var a=n("IKa1"),r=n("Yh9w"),o=(n("r0ML"),n("V0Ug")),i=n("sN0p");n("xH0s");const s=["components"],c={};void 0!==c&&c&&c===Object(c)&&Object.isExtensible(c)&&!Object.prototype.hasOwnProperty.call(c,"__filemeta")&&Object.defineProperty(c,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"src/docs/events-decorator.mdx"}});const l={_frontmatter:c},m=i.a;function p(e){let{components:t}=e,i=Object(r.a)(e,s);return Object(o.b)(m,Object(a.a)({},l,i,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h1",{id:"emitting-events-using-decorators"},"Emitting Events using Decorators"),Object(o.b)("p",null,"Instead of manually injecting the event class and emitting events, you can create special event emitter decorators that does just that for you. You can create your own event emitter decorator using a factory method that creates the emitter behind the scene.",Object(o.b)("br",{parentName:"p"}),"\n","This makes it much easier to emit events as you don't have to manually create an instance of the event emitter, define the event, and emit it with the correct payload. It also helps keep your code organized and easy to understand, as you can clearly see which methods emit which events, and how the returned values are mapped to event payloads."),Object(o.b)("h2",{id:"event-emitter-factory"},"Event Emitter Factory"),Object(o.b)("p",null,"Texpress provides a factory method ",Object(o.b)("inlineCode",{parentName:"p"},"EventEmitterDecoratorFactory"),". Using this utility method, you can create method decorators that emit events from the current event type.",Object(o.b)("br",{parentName:"p"}),"\n",Object(o.b)("strong",{parentName:"p"},"NOTE: There is one thing to keep in mind when emitting events using decorators. The payload needed to emit/consume the event must be returned by the method the decorator is applied to.")),Object(o.b)("h3",{id:"using-the-eventemitterdecoratorfactory"},"Using the EventEmitterDecoratorFactory"),Object(o.b)("p",null,"The EventEmitterDecoratorFactory takes three arguments,"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"Event class")," as the first argument"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"Name of the event")," to be emitted as the second argument"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"Mapper function")," as the third argument that maps the return value of the applied decorator's method to the payload required to emit the decorator.")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-javascript"},"\nexport const AuthEventsEmitter = <EventName extends keyof AuthEventsTypes>(\n    event: EventName,\n    mapper: (returnedValue: any) => AuthEventsTypes[EventName] | false\n) => EventEmitterDecoratorFactory(AuthEvents, event, mapper);\n\n")),Object(o.b)("p",null,"The above example may look weird if you haven't worked with TypeScript decoratos as much. But let's try to break it down,"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"First we create a method called ",Object(o.b)("inlineCode",{parentName:"p"},"AuthEventsEmitter"),". This method takes a generic type ",Object(o.b)("inlineCode",{parentName:"p"},"EventName")," constrained to keyof ",Object(o.b)("inlineCode",{parentName:"p"},"AuthEventsTypes"),". This means that the first arugment ",Object(o.b)("inlineCode",{parentName:"p"},"event")," of type ",Object(o.b)("inlineCode",{parentName:"p"},"EventName")," can only be one of the keys in the ",Object(o.b)("inlineCode",{parentName:"p"},"AuthEventsTypes")," interface."),Object(o.b)("blockquote",{parentName:"li"},Object(o.b)("p",{parentName:"blockquote"},Object(o.b)("inlineCode",{parentName:"p"},"AuthEventsTypes")," is one of ",Object(o.b)("inlineCode",{parentName:"p"},"EventTypes")," as explained in the ",Object(o.b)("inlineCode",{parentName:"p"},"Events")," section of the documentation."))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"The second argument mapper is a function that takes a single argument ",Object(o.b)("inlineCode",{parentName:"p"},"returnedValue")," and returns either an array of payload",Object(o.b)("inlineCode",{parentName:"p"},"or"),"false",Object(o.b)("inlineCode",{parentName:"p"},". The return type of the mapper function is constrained to the type of the corresponding event in the "),"AuthEventsTypes` interface."),Object(o.b)("blockquote",{parentName:"li"},Object(o.b)("p",{parentName:"blockquote"},Object(o.b)("strong",{parentName:"p"},"Note the ",Object(o.b)("inlineCode",{parentName:"strong"},"false")," value for mapper. This is used for conditionally emitting events. Look at the end of this page for Conditional Event Emitting.")))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"The ",Object(o.b)("inlineCode",{parentName:"p"},"AuthEventsEmitter")," method then forwards these arguments to the ",Object(o.b)("inlineCode",{parentName:"p"},"EventEmitterDecoratorFactory")," followed by the Event class which is ",Object(o.b)("inlineCode",{parentName:"p"},"AuthEvents")," in above example."))),Object(o.b)("h2",{id:"emitting-events-using-decorator"},"Emitting Events using Decorator"),Object(o.b)("p",null,"Now let's take an look into how to the above emitter."),Object(o.b)("p",null,"Consider the AuthEvents has the following event types:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-javascript"},"interface AuthEventTypes {\n    'send-welcome-email': [{ user: UserEntity, emailCode: string }];\n    // ...other event types as needed\n}\n")),Object(o.b)("p",null,"Now let's emit this event."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-javascript"},"\nclass AuthService() {\n\n    @AuthEventsEmitter(\n        // First argument, the name of the event from AuthEventTypes, 'send-welcome-email'\n        'send-welcome-email',\n        // Second argument, A mapper function that takes the returned value of the method createUserAndSendEmail() as argument\n        // and returns a payload matching the payload type for the event, 'send-welcome-email'\n        (returnedValue: { user: UserEntity, emailCode: string }) =>\n            [\n                { user: returnedValue.user, emailCode: returnedValue.emailCode }\n            ]\n    )\n    async createUserAndSendEmail() {\n        // logic to create user\n\n        // MUST return the payload needed to emit the event.\n        // In this case, an object having user payload and the email code.\n        return {\n            user: user,\n            emailCode: 'WELCOME_EMAIL'\n        }\n    }\n}\n\n")),Object(o.b)("p",null,"A visual representation"),Object(o.b)("img",{src:n("D+kM"),style:{width:"70%"}}),Object(o.b)("h2",{id:"conditional-event-emitting"},"Conditional Event Emitting"),Object(o.b)("p",null,"There can be situations where you only need to emit the event based on some conditions. The ",Object(o.b)("inlineCode",{parentName:"p"},"false")," value on mapper that you might have seen in above examples when creating the event emitter decorator does exactly this. The mapper function either maps the returned value of the method to the payload required for emitting the event or maps to ",Object(o.b)("inlineCode",{parentName:"p"},"false")," value. When mapped to ",Object(o.b)("inlineCode",{parentName:"p"},"false"),", the event is not emitted."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-javascript"},"\nclass AuthService() {\n\n    @AuthEventsEmitter(\n        'send-welcome-email',\n        (returnedValue: { user: UserEntity, emailCode: string }) =>\n            returnedValue.user.sendEmail === true ?\n            [\n                { user: returnedValue.user, emailCode: returnedValue.emailCode }\n            ] :\n            false\n    )\n    async createUserAndSendEmail() {\n        // logic to create user\n        return {\n            user: user,\n            emailCode: 'WELCOME_EMAIL'\n        }\n    }\n}\n\n")),Object(o.b)("p",null,"In above example, the event is only emitted if the user payload in the returned value of the method ",Object(o.b)("inlineCode",{parentName:"p"},"createUserAndSendEmail()")," has the ",Object(o.b)("inlineCode",{parentName:"p"},"sendEmail")," property set to ",Object(o.b)("inlineCode",{parentName:"p"},"true"),"."))}void 0!==p&&p&&p===Object(p)&&Object.isExtensible(p)&&!Object.prototype.hasOwnProperty.call(p,"__filemeta")&&Object.defineProperty(p,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"src/docs/events-decorator.mdx"}}),p.isMDXComponent=!0},"D+kM":function(e,t,n){e.exports=n.p+"static/code_1-7e73c9e03774b021ff894122efb625dd.jpg"}}]);
//# sourceMappingURL=component---src-docs-events-decorator-mdx-313e7a60548c41cbb716.js.map